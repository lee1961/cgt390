<html>
<head>
  <title>My first Three.js app</title>
  <style>
    body { margin: 0; }
    canvas { width: 50%; height: 50% }
  </style>
</head>
<body>
  <script src="js/three.min.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script>
    var camera;
    var scene;
    var renderer;
    var sphere,sphere_geometry,sphere_material;
    var plane,plane_geometry,plane_material;
    var camera_controls;

    var sceneTime = 0.0;
    var elapsedTime = undefined;
    var initialTime = undefined;

    var velocity = -1;
    var ball_gravity = 9.8;

    init();
    animate();
    function init() {
        //setting up the camera
        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 10000 );
        //camera.position.y = 500;
        //camera.position.z = 500;
        camera.position.set(0,30,100);
        scene = new THREE.Scene();

        var light = new THREE.SpotLight();
        light.position.set( 1000, 1000, 1000 );
      //light.position.set( 1000, 1000, 1000 );
      light.target.position.set( 0, 0, 0 );
      light.castShadow = true;
      scene.add( light );

      sphere_geometry = new THREE.SphereGeometry( 50, 16, 12 );
      sphere_material  = new THREE.MeshPhongMaterial( { color: 0xff0000, specular: 0xFFFFFF, shininess: 5, opacity: 1, wireframe: false } );

      sphere = new THREE.Mesh(sphere_geometry,sphere_material);
      sphere.scale.set(0.1,0.1,0.1); // setting the size of the ball
      sphere.position.set(0,50,0);
      
      //SETTING UP THE initial attributes to calculate acceleration of a ball when it drops!
      sphere.H0 = 50; // the default height!
      sphere.V0 = 0;
      sphere.VF = Math.sqrt(2 * ball_gravity * sphere.H0);
      sphere.HF = 0;
      sphere.bouncing_time = 0;
      sphere.bounciness = 1;
      //END OF SETTING UP!

      scene.add(sphere);
      plane_geometry = new THREE.PlaneGeometry( 500, 500, 8, 8 );
      plane_material = new THREE.MeshLambertMaterial( { color: 0xFFFFFF, wireframe: true } );
      plane = new THREE.Mesh(plane_geometry,plane_material);
      plane.scale.set(0.3,0.3,0.3);
      plane.rotation.x = -Math.PI/2;
      plane.position.set(0,0,0);
        //plane.castShadow = false;

        scene.add(plane);

        camera.lookAt(plane.position);
        //setting up the renderer
        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.setClearColor( 0xFFFFFF );
        //renderer.shadowMapEnabled = true;
        document.body.appendChild( renderer.domElement );

        var button = document.getElementById("button"); // getting a button!
        var slider =  document.getElementById('slider'); // getting the slider for bounciness
        var slider_size =  document.getElementById('slider_size');
       //adding some  camera controls
       camera_controls = new THREE.OrbitControls( camera, renderer.domElement );
       //starting the timer
       initialTime = (new Date).getTime();
     }

     function animate() {
      requestAnimationFrame(animate);
        //sphere.rotation.x += 0.1;
        camera_controls.update();
        sceneTime += 33/1000;
        render();
      }

      function render() {
       // var h = sphere.position.y;
       // h = this.H0 + (this.V0 * 2) - (0.5 * ball_gravity);

       updatePosition();

       


       renderer.render(scene,camera);  
     }
     var flag = 1;

     function updatePosition() {
      //console.log("position is " + sphere.position.y);
      var t = sceneTime - sphere.bouncing_time;
      var h = sphere.position.y;
      h = sphere.H0 + (sphere.V0 * t) - (0.5 * ball_gravity * t * t);
      //console.log("the sphere vf is " + sphere.H0);

      if( h <= 0 ) {
       // ball_gravity = -ball_gravity;
       /*
       sphere.H0 = 0; // the default height!
       sphere.V0 = 0;
       sphere.VF = Math.sqrt(2 * ball_gravity * this.H0);
       console.log("the sphere vf is " + sphere.VF);
       sphere.HF = 0;
       sphere.bouncing_time = 0;
       sphere.bounciness = 0.5;
       sceneTime = 0;
       */
       sphere.bouncing_time = sceneTime;
       sphere.V0 = sphere.VF * sphere.bounciness;
       sphere.HF = (sphere.V0 * sphere.V0) / (2 * ball_gravity);
       sphere.VF = Math.sqrt(2*ball_gravity*sphere.HF);
       sphere.H0 = 0;
       //console.log("the sphere vf is " + sphere.bounciness);
       
     } else  {
       sphere.position.y = h;
         //flag = -1;
       }
      /*
      if (h <= 0) {
        sphere.bouncing_time = sceneTime;
        sphere.V0 = sphere.VF * sphere.bounciness;
        sphere.HF = (sphere.V0 * sphere.V0) / (2 * ball_gravity);
        sphere.VF = Math.sqrt(2*ball_gravity*sphere.HF);
        sphere.H0 = 0;
      } else {
        sphere.position.y = h;
      }
      */
      
    }


  </script>
</body>
<button id="button" onclick="myFunction()"> change gravity </button>
<input type="range" name="slider" min="0.5" max="2" step="0.1" value="1" id="slider">
<input type="range" name="slider_size" min="0.1" max="1" step="0.1" value="0.1" id="slider_size">
<script type="text/javascript">
// this is the place where you declare all the buttons all that so that you can access any variable!
button.onclick = function() {
  //sphere.rotation.x += 0.1;
  // reinitializing some stuff
 // var temp_h0 = sphere.position.y;
  ball_gravity = 1/6 * ball_gravity;
   sphere.H0 = 50; // the default height!
   sphere.V0 = 0;
   sphere.VF = Math.sqrt(2 * ball_gravity * sphere.H0);
   sphere.HF = 0;
   sphere.bouncing_time = 0;
   sphere.bounciness = 1;
   sceneTime = 0;
   //scene.remove(sphere);


 }
 slider.onchange = function() {   
   sphere.H0 = 50; // the default height!
   sphere.V0 = 0;
   sphere.VF = Math.sqrt(2 * ball_gravity * sphere.H0);
   sphere.HF = 0;
   sphere.bouncing_time = 0;
   sphere.bounciness = this.value;
   sceneTime = 0;
  // scene.remove(sphere);
}
slider_size.onchange = function() {
  sphere.scale.set(this.value,this.value,this.value);
}

  </script>
  </html>